---
sidebar_position: 1

---

# [Bottle Neko] 我想改版了！

嗨嗨大家好，我是作者罐罐！

V2 的計畫從貓罐子半週年的時候，就已經開始計畫了，並且期待能夠在一週年的時候，一同推出這個大型改版！

至於為什麼要做這件事，我這邊有幾點分享給大家，也希望未來的開發者也能少掉點坑 XD

- 載入很慢，等待很久
- 功能東補西補整個專案難以維護
- SEO
- Security 問題

這些也是大家會常常碰到的問題，大概說明一下這些狀況吧～



## 效能問題

我想這也是目前每個開發者最頭痛的問題，網站越跑越慢，想要深入去調教效能或是優化 Code 又不知道從何下手。沒錯，效能問題引發的原因非常多，有可能是處理非同步資料太久、Render 太大量的數據、一次改動太多狀態，甚至是本身就已經出錯卻沒有處理 error handling，種種因素都是淺在風險，如果開發時沒有特別注意，那還真的難以迴避。

但總歸一句：**會讓人覺得很慢，原因就出在使用者不知道你現在到底在幹嘛**，<br/>
多注重使用者操作介面的狀態顯示，其實是很重要的，像是 Loading View (甚至是％數比例)、先 show 已載入完成的資料、處理 error 例外狀況或是回報頁面，都能夠讓使用者知道：喔我現在等數據回來，~~我該買新手機了~~，而不是壞掉了。

但這終究是治標不治本的方法，還是得要回到影響效能問題的本身來解決，小則改個 function 寫法、或是換用其他人寫的 plugin，大到改變整個專案架構、或是換框架都是有可能的，**效能議題是必須在專案前期規劃時，就要一起思考進去的！**

我非常建議大家使用這個工具：[Core Web Vitals](https://web.dev/vitals/) 

這是 Google 在 2020 年推出的改進網站 UX 的效能指標，用他的檢測工具，可以快速地知道網站有哪些效能問題，方便你知道哪邊出現狀況。作者我早在 2017年參加 JSDC 時，就有聽過一位從 Google 來的開發者介紹過，並且推薦大家使用 [Lighthouse](https://developers.google.com/web/tools/lighthouse?hl=zh-tw) 來檢測網站效能，如今已經發展成這個 Web Vitals 指標，表示 Google 很注重這塊啊 XD

這邊我給幾個小建議，也希望大家可以在開發時多注意這幾點：

- 注意元件的生命週期，該什麼時候載入非同步資料、該什麼時候 Render 畫面，要能夠清楚了解，很多狀況是父子元件同時在跑，會出現要等待全部 `Async function` 回來，那樣就會等待更長的時間才去 Render。
- 如果遇到連續非同步資料出現，`Async function` 最好不要寫成一堆 `await` 去抓資料，簡單的方式是用 `await Promise.all()` 處理，或是用其他人做好的 Data fetching 套件來做，像是：`react swr`、`vue swrv`... 等。
- 對於大量 serializable 資料，建議分成數個非同步資料來抓，像是：分頁、無限載入。
- 對於大型 media 資料，建議用 Lazy Loading，來延遲載入。
- 更困難一點，要注意整個專案架構，減少元件的相依性 (dependence) ，處理資料跟畫面渲染要分開，避免牽一髮動全身。

>貓罐子困難：
>
>其實貓罐子最大的問題是出在選擇框架上跟 API 問題，也是最難解決的。一開始架構上沒問題，元件與頁面也切的很棒，但是問題出在我們一開始選用 CSR 來做，也就是大家常聽到的 SPA。
>
>加上接下來要談的專案架構部分，網站第一時間要抓過多的 JS 資料以及處理非同步，導致要過多的時間載入。更何況從 SPA 改裝成 SSR 是一件非常困難的事。

## 專案架構

**如同上面的效能問題一樣，專案架構一開始就要釐清與安排好，要考慮各種因素，及未來維護的可行性。**

產品推出後，一定會有一堆 bug fix 或是 extra plugins 補完整體的功能，但是這些東補西補，很容易就做出難以維護的專案，甚至是讓程式崩潰。

選用框架也是很重要的一件事，早在貓罐子一開始，跟上 SPA 搭上 PWA 的順風車，而做出這些

